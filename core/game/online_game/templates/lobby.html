{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messa Pong - Lobby</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;900&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/pong.css' %}">
    <link rel="stylesheet" href="{% static 'css/title.css' %}">
    <link rel="stylesheet" href="{% static 'css/lobby.css' %}">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title" data-text="Messa Pong">Messa Pong</h1>
            <div class="status success">Game Lobby</div>
        </div>
        
        <div class="lobby-content">
            {% if message %}
            <div class="lobby-message error">
                <i class="fas fa-exclamation-circle"></i>
                <span>{{ message }}</span>
                <a href="{% url 'game_lobby' %}" class="refresh-button">
                    <i class="fas fa-sync-alt"></i> Check Again
                </a>
            </div>
            {% endif %}
            
            <div class="lobby-info">
                <h2>Ready to Play?</h2>
                <p>Click the button below to join the matchmaking queue and get matched with another player automatically.</p>
            </div>
            
            <div class="lobby-actions">
                {% if at_capacity %}
                    <div class="capacity-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        System is at maximum capacity (2 players). Please try again later.
                    </div>
                {% else %}
                    <a href="{% url 'join_queue' %}" class="join-queue-btn">
                        <i class="fas fa-gamepad"></i> Click to Join Lobby
                    </a>
                {% endif %}
            </div>
            
            <div class="lobby-stats">
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span class="stat-value">{{ active_players }}</span>
                    <span class="stat-label">Players Online</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-trophy"></i>
                    <span class="stat-value">{{ active_games }}</span>
                    <span class="stat-label">Active Games</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add the automatic cleanup service -->
    <script src="{% static 'js/cleanup.js' %}"></script>
    
    <!-- Add extra capacity protection -->
    <script>
        // Hard client-side protection against joining when at capacity
        document.addEventListener('DOMContentLoaded', function() {
            // Check capacity status directly from the server-rendered template
            var isAtCapacity = {% if at_capacity %}true{% else %}false{% endif %};
            
            if(isAtCapacity) {
                // Find all join buttons and disable them
                var joinButtons = document.querySelectorAll('.join-queue-btn');
                joinButtons.forEach(function(button) {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        alert('System is at maximum capacity (2 players). Please try again later.');
                        return false;
                    });
                    button.classList.add('disabled');
                    button.style.opacity = '0.5';
                    button.style.cursor = 'not-allowed';
                });
                
                console.warn('System at capacity - join button disabled');
            }
        });
    </script>
</body>
</html> 